{
 "properties": {
  "displayName": "NFCU Security Benchmark Audit v1.0",
  "policyType": "Custom",
  "description": "This initiative contains Data privacy and Protection policies involving Logging, Data transfers, Versioning and recoverability security controls for Azure Resources.",
  "metadata": {
   "category": "Security Benchmark",
   "version": "1.0",
   "createdBy": "866a1b9f-e9ad-4113-8aa3-7270e7243649",
   "createdOn": "2021-02-17T21:39:14.6013401Z",
   "updatedBy": "37a67bdc-f4b9-4038-9a29-9949d32a1f98",
   "updatedOn": "2021-03-02T18:53:46.8792456Z",
   "parameterScopes": {
    "listOfLocations": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19",
    "PrivateEndpoint_vNet": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19"
   }
  },
  "parameters": {},
  "policyDefinitions": [
   {
    "policyDefinitionReferenceId": "AuthenticationshouldbeenabledonyourFunctionapp",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c75248c1-ea1d-4a9c-8fc9-29a6aabd5da8",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Digital Identity"
    ]
   },
   {
    "policyDefinitionReferenceId": "AuthenticationshouldbeenabledonyourAPIapp",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c4ebc54a-46e1-481a-bee2-d4411e95d828",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Digital Identity"
    ]
   },
   {
    "policyDefinitionReferenceId": "AuthenticationshouldbeenabledonyourWebapp",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/95bccee9-a7f8-4bec-9ee9-62c3473701fc",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Digital Identity"
    ]
   },
   {
    "policyDefinitionReferenceId": "ManagedIdentitysecuresettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Managed Identity secure settings v1.0",
    "parameters": {
     "identity.type.value": {
      "value": [
       "SystemAssigned"
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Digital Identity"
    ]
   },
   {
    "policyDefinitionReferenceId": "RedisCacheSecureSettingsv1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Redis Cache secure settings v1.0",
    "parameters": {
     "enableNonSslPort": {
      "value": [
       true
      ]
     },
     "minimumTlsVersion": {
      "value": [
       "1.2"
      ]
     }
    },
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "RemotedebuggingshouldbeturnedoffforAPIApps",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/e9c8d085-d9cc-4b17-9cdc-059f1f01f19e",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "RemotedebuggingshouldbeturnedoffforFunctionApps",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "RemotedebuggingshouldbeturnedoffforWebApplications",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba-4d9f-a230-cb0976f4bb71",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "AllauthorizationrulesexceptRootManageSharedAccessKeyshouldberemovedfromEventHubnamespace",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b278e460-7cfc-4451-8294-cccc40a940d7",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "AllauthorizationrulesexceptRootManageSharedAccessKeyshouldberemovedfromServiceBusnamespace",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/a1817ec0-a368-432a-8057-8371e17ac6ee",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "APIAppshouldonlybeaccessibleoverHTTPS",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b7ddfbdc-1260-477d-91fd-98bd9be789a6",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "FunctionAppshouldonlybeaccessibleoverHTTPS",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "EnsureAPIapphas'ClientCertificates(Incomingclientcertificates)'setto'On'",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/0c192fe8-9cbb-4516-85b3-0ade8bd03886",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "Ensure WEB app has 'Client Certificates (Incoming client certificates)' set to 'On'",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/5bb220d9-2698-4ee4-8404-b9c30c9df609",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "EnsureFunctionapphas'ClientCertificates(Incomingclientcertificates)'setto'On'",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/eaebaea7-8013-4ceb-9d14-7eb32271373c",
    "parameters": {},
    "groupNames": [
     "Manage and Govern Application Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "DiagnosticLogssecuresettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Diagnostic Logs Secure Settings v1.0",
    "parameters": {
     "resourceTypes": {
      "value": [
       "Microsoft.DataFactory/factories",
       "Microsoft.DataLakeStore/accounts",
       "Microsoft.Network/applicationGateways",
       "Microsoft.KeyVault/vaults",
       "Microsoft.RecoveryServices/vaults",
       "Microsoft.Databricks/workspaces",
       "Microsoft.Compute/virtualMachineScaleSets",
       "Microsoft.Network/FrontDoorWebApplicationFirewallPolicies",
       "Microsoft.Web/sites"
      ]
     },
     "workspaceId": {
      "value": [
       true
      ]
     },
     "storageAccountId": {
      "value": [
       true
      ]
     },
     "eventHubAuthorizationRuleId": {
      "value": [
       true
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "SQLServerVersionSettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/SQL Server Version Settings v1.0",
    "parameters": {
     "version": {
      "value": [
       "12.0"
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "KeyVaultSecureSettingV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Key Vault Secure Settings v1.0",
    "parameters": {
     "enabledForDeployment": {
      "value": [
       true,
       false
      ]
     },
     "enabledForDiskEncryption": {
      "value": [
       true,
       false
      ]
     },
     "enabledForTemplateDeployment": {
      "value": [
       true,
       false
      ]
     },
     "enablePurgeProtection": {
      "value": [
       true
      ]
     },
     "enableSoftDelete": {
      "value": [
       true
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "Geo-redundantstorageshouldbeenabledforStorageAccounts",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/bf045164-79ba-4215-8f95-f8048dc1780b",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "SoftDeleteonBlobStorageaccountsv2.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Soft Delete on Blob Storage accounts v2.0",
    "parameters": {
     "retentionDays": {
      "value": 90
     }
    },
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "AdvanceddatasecurityshouldbeenabledonyourSQLServers",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/abfb4388-5bf4-4ad7-ba82-2cd2f41ceae9",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "AnAzureActiveDirectoryadministratorshouldbeprovisionedforSQLservers",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "Automationaccountvariablesshouldbeencrypted",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/3657f5a0-770e-44a3-b44e-9431ba1e9735",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "AzureDefenderforStorageshouldbeenabled",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/308fbb08-4ab8-4e67-9b29-592e93fb94fa",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "RequireStorageFileEncryption",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Require Storage File Encryption v1.0",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "Securetransfertostorageaccountsshouldbeenabled",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "TransparentDataEncryptiononSQLdatabasesshouldbeenabled",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "VulnerabilityassessmentshouldbeenabledonSQLManagedInstance",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1b7aa243-30e4-4c9e-bca8-d0d3022b634a",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "RequireEncryptiononStorageAccounts",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Require Encryption on Storage Accounts v1.0",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "AuditingonSQLservershouldbeenabled",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9",
    "parameters": {
     "setting": {
      "value": "enabled"
     }
    },
    "groupNames": [
     "Protect and Secure Data Privacy and Protection"
    ]
   },
   {
    "policyDefinitionReferenceId": "MySQLSSLEnforcementSettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/MySQL SSL Enforcement Settings v1.0",
    "parameters": {
     "sslEnforcement": {
      "value": [
       "Enabled"
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "SQLManagedInstancessecuresettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/SQL Managed Instances secure settings v1.0",
    "parameters": {
     "publicDataEndpointEnabled": {
      "value": [
       true
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "VirtualNetworksecuresettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Virtual Network secure settings v1.0",
    "parameters": {
     "subnets.star.networkSecurityGroup": {
      "value": [
       false,
       true
      ]
     },
     "subnets.star.name": {
      "value": [
       "default",
       "GatewaySubnet",
       "AzureFirewallSubnet",
       "ALL"
      ]
     },
     "enableDdosProtection": {
      "value": [
       true
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "CosmosDBshoulduseavirtualnetworkserviceendpoint",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/e0a2b1a3-f7f9-4569-807f-2a9edebdf4d9",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "KeyVaultshoulduseavirtualnetworkserviceendpoint",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/ea4d6841-2173-4317-9747-ff522a45120f",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "RDPaccessfromtheInternetshouldbeblocked",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/e372f825-a257-4fb8-9175-797a8a8627d6",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "SSHaccessfromtheInternetshouldbeblocked",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2c89a2e5-7285-40fe-afe0-ae8654b92fab",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "NetworkApplicationGatewaySecureSettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Network Application Gateway Secure Settings v1.0",
    "parameters": {
     "sku.tier": {
      "value": [
       "WAF",
       "WAF_v2"
      ]
     },
     "webApplicationFirewallConfiguration.firewallMode": {
      "value": [
       "Prevention"
      ]
     },
     "webApplicationFirewallConfiguration.enabled": {
      "value": [
       true
      ]
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "NetworkWatchershouldbeenabled",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b6e2945c-0b7b-40f5-9233-7a5323b5cdc6",
    "parameters": {
     "listOfLocations": {
      "value": [
       "East US",
       "South Central US"
      ]
     },
     "resourceGroupName": {
      "value": "NetworkWatcherRG"
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "PrivateendpointenabledforMySQLserversV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Private endpoint enabled for MySQL servers v1.0",
    "parameters": {
     "PrivateEndpoint_vNet": {
      "value": "NA"
     }
    },
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "LatestTLSversionshouldbeusedinyourFunctionApp",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "LatestTLSversionshouldbeusedinyourWebApp",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "AppServiceshoulduseavirtualnetworkserviceendpoint",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2d21331d-a4c2-4def-a9ad-ee4e1e023beb",
    "parameters": {},
    "groupNames": [
     "Protect and Secure Network and Endpoint Security"
    ]
   },
   {
    "policyDefinitionReferenceId": "CosmosDBSecureSettingsV1.0",
    "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policyDefinitions/Cosmos DB Secure Settings v1.0",
    "parameters": {
     "enableAutomaticFailover": {
      "value": [
       true
      ]
     },
     "defaultConsistencyLevel": {
      "value": [
       "Strong",
       "BoundedStaleness",
       "Session",
       "ConsistentPrefix"
      ]
     }
    },
    "groupNames": [
     "Visibility and Monitoring Cyber Defense"
    ]
   },
   {
    "policyDefinitionReferenceId": "VirtualmachinesshouldbemigratedtonewAzureResourceManagerresources",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1d84d5fb-01f6-4d12-ba4f-4a26081d403d",
    "parameters": {},
    "groupNames": [
     "Visibility and Monitoring Cyber Defense"
    ]
   },
   {
    "policyDefinitionReferenceId": "AzureBackupshouldbeenabledforVirtualMachines",
    "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/013e242c-8828-4970-87b3-ab247555486d",
    "parameters": {},
    "groupNames": [
     "Visibility and Monitoring Cyber Defense"
    ]
   }
  ],
  "policyDefinitionGroups": [
   {
    "name": "Protect and Secure Data Privacy and Protection"
   },
   {
    "name": "Protect and Secure Digital Identity"
   },
   {
    "name": "Protect and Secure Network and Endpoint Security"
   },
   {
    "name": "Manage and Govern Application Security"
   },
   {
    "name": "Visibility and Monitoring Cyber Defense"
   }
  ]
 },
 "id": "/providers/Microsoft.Management/managementGroups/389b7e7c-4be2-4213-81b1-9e3a9afabd19/providers/Microsoft.Authorization/policySetDefinitions/SecBenchmarkAudit v1.0",
 "type": "Microsoft.Authorization/policySetDefinitions",
 "name": "SecBenchmarkAudit v1.0"
}